# callr

## Calling R from the shell

```{r, echo=FALSE, results=FALSE}
suppressMessages(devtools::load_all())
knitr::knit_hooks$set(output = function(x, options)
  paste0("```json\n", x, "```\n"))
```

[![Build Status](https://travis-ci.org/traitecoevo/callr.png?branch=master)](https://travis-ci.org/traitecoevo/callr)

Simple package for calling R from elsewhere via json

```{r, echo=FALSE, comment=NA}
dat <- list("function"="myfunction",
            args=list(list(name="foo", value="bar")))
json <- jsonlite::prettify(jsonlite::toJSON(dat, auto_unbox=TRUE))
writeLines(json, "myfile.json")
json
```

Then:

```{r, echo=FALSE, results=FALSE}
myfunction <- function(foo) {
  rep(foo, 3)
}
callr("myfile.json")
```

```
callr myfile.json
```

runs

```r
myfunction(foo="bar")
```

and saves the result in the element `value` in the original json.

```{r, echo=FALSE, comment=NA}
writeLines(readLines("myfile.json"))
```

Further options:

```{r, echo=FALSE, comment=NA}
knitr::knit_hooks$set(output = function(x, options)
  paste0("```\n", x, "```\n"))
writeLines(system2("callr", "--help", stdout=TRUE))
```

## Script installation

Using `callr` is easiest if you install the `callr` script:

```r
devtools::install_github("traitecoevo/callr")
callr::install("~/bin")
```
The second line copies the `callr` script somewhere -- preferably in your `$PATH`.

This allows using `callr` from the shell with:

```
callr myfile.json
```

or from your favourite other scripting language through their system interface.

## Calling system programs from R

Calling system commands from R error prone as error handling is inconsistent.  `callr` includes a function `call_system` to help here.  This is a very thin wrapper around `system2`, and hides output unless there is an error (exit code other than 0) when it throws an error and prints a (possibly truncated) error message.

All output (non-truncated) will be returned by a successful run of `call_system`.
